- name: Download Prometheus
  get_url:
    url: https://github.com/prometheus/prometheus/releases/download/v2.22.0/prometheus-2.22.0.linux-armv7.tar.gz
    dest: /tmp/prometheus-2.22.0.linux-armv7.tar.gz
  tags:
  - install

- name: Untar File
  unarchive:
    src: /tmp/prometheus-2.22.0.linux-armv7.tar.gz
    dest: /tmp/
    remote_src: true

- name: Remove old folder if present
  file:
    state: absent
    path: /opt/prometheus
  tags:
  - install

- name: Move install folder
  command: mv /tmp/prometheus-2.22.0.linux-armv7 /opt/prometheus
  tags:
  - install

- name: Create Prometheus User
  user:
    state: present
    name: prometheus
  tags:
  - install

- name: Set Permissions on Prometheus
  file:
    path: /opt/prometheus
    owner: prometheus
    recurse: true
  tags:
  - install

- name: Copy Unit File
  copy:
    src: prometheus.service
    dest: /etc/systemd/system/prometheus.service
  tags:
  - install

- name: Enable/Start Prometheus
  systemd:
    daemon_reload: true
    state: restarted
    name: prometheus
    enabled: true
  tags:
  - install